var map;var markerToPlot;var positionToPlot;var alreadyClicked;var emsg="Something went wrong";var alreadyMarked={fillColor:"#FF0000",center:null,map:null,radius:2,fillOpacity:1,strokeColor:"#FF0000",strokeOpacity:1};function updateMapMarker(a,b){map.setCenter(a);map.setZoom(b);markerToPlot.setPosition(a);markerToPlot.setAnimation(google.maps.Animation.BOUNCE)}function reinitlize(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(a){positionToPlot=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);updateMapMarker(positionToPlot,17)},function(){showAlert("Give access to your device location.",true);positionToPlot=new google.maps.LatLng(21.1289956,82.7792201);updateMapMarker(positionToPlot,4)})}else{showAlert("Your browser does not support Geolocation.",true)}}function initialize(){var a={zoom:17};map=new google.maps.Map(document.getElementById("map-canvas"),a);alreadyMarked.map=map;markerToPlot=new google.maps.Marker({position:positionToPlot,map:map,draggable:true,animation:google.maps.Animation.BOUNCE,title:"Drag me to adjust. Click me to mark."});reinitlize();google.maps.event.addListener(markerToPlot,"click",function(b){if(alreadyClicked){return}markerToPlot.setAnimation(null);placeMarker(b.latLng,map)});plotExistingMarkers();$("#closebtn,#closebtn1").click(function(){resetForm();reinitlize()});$("#savebtn").click(function(){saveMarker()});Recaptcha.create("6LeRZvwSAAAAAGjP7P9C-FAsrA9TQz3FnjRcqYE1","recaptcha_div",{theme:"white",callback:Recaptcha.focus_response_field});$("#myModal").on("hidden.bs.modal",function(b){alreadyClicked=false})}function plotExistingMarkers(){$.post("nitro/nitro.php?action=getMarkers").done(function(b){if(typeof b=="string"){b=jQuery.parseJSON(b)}if((b.errorcode!=0)||(b.message!="Done")){bootbox.alert(emsg);return}if(b.markers==null){console.log("Nothing to show");return}for(var a=0;a<b.markers.length;a++){var d=new google.maps.LatLng(b.markers[a].Lat,b.markers[a].Lng);alreadyMarked.center=d;new google.maps.Circle(alreadyMarked)}},"json")}function saveMarker(){$("#markerForm").submit()}function resetForm(){$("#markerForm")[0].reset()}function placeMarker(a,b){alreadyClicked=true;$(".modal-footer").css("display","block");$("#markerForm")[0].reset();$("#formdiv").css("display","block");$(".progress").css("display","none");$(".modal-header").removeClass("alert-warning");$("#myModalLabel").text("Do you want to declare this place dirty ?");$("#Lat").val(a.k);$("#Lng").val(a.B);$("#savebtn").addClass("btn-success");$("#savebtn").text("Save");$("#myModal").modal("show");$("#SelectM input[name='SelectMode']").click(function(){if($("input:radio[name=SelectMode]:checked").val()==1){$("#dirtyPic").attr("capture","camera")}else{$("#dirtyPic").removeAttr("capture")}});$("#dirtyPic").fileinput({showUpload:false,previewFileType:"image",allowedFileTypes:["image"],browseClass:"btn btn-primary",browseLabel:"Select",browseIcon:'<i class="glyphicon glyphicon-picture"></i>',removeClass:"btn btn-danger",removeLabel:"Delete",removeIcon:'<i class="glyphicon glyphicon-trash"></i>'});$("form#markerForm").submit(function(d){d.preventDefault();$("#myModalLabel").text("Please be patient");$(".progress").css("display","block");$("#formdiv").css("display","none");$(".modal-footer").css("display","none");var c=new FormData($(this)[0]);$.ajax({url:"nitro/nitro.php?action=saveMarker",type:"POST",data:c,cache:false,contentType:false,processData:false,beforeSend:function(f,e){if(!alreadyClicked){console.log("aborting as already posted");f.abort()}else{alreadyClicked=false}},xhr:function(){var e=$.ajaxSettings.xhr();e.upload.onprogress=function(g){if(g.lengthComputable){var f=Math.round((g.loaded/g.total)*10000)/100+"%";updateProgressBar(f)}};e.upload.onload=function(){$(".progress-bar").text("Done!")};return e},success:function(e){if(typeof e=="string"){e=jQuery.parseJSON(e)}if(e.errorcode!=0||e.message!="Done"){$("#myModalLabel").text("Error in Upload: "+e.message);$(".modal-footer").css("display","block");$("#formdiv").css("display","block");$("#savebtn").text("Re-try");$("#savebtn").addClass("btn-danger").removeClass("btn-success");$(".progress").css("display","none");Recaptcha.reload();$(".modal-header").addClass("alert-warning")}else{showAlert("You are done!! Have a look in view tab or mark another location.",false);$("#myModal").modal("hide");$(".modal-header").removeClass("alert-warning");reinitlize();var f=new google.maps.LatLng(e.marker.Lat,e.marker.Lng);alreadyMarked.center=f;new google.maps.Circle(alreadyMarked)}updateProgressBar("0%");alreadyClicked=true},failure:function(e){showAlert("Something went wrong, Please try again later",true);updateProgressBar("0%");reinitlize()}})})}function updateProgressBar(a){$(".progress-bar").text(a);$(".progress-bar").css("width",a)}function showAlert(b,a){if(a){$(".alert").addClass("alert-danger").removeClass("alert-success")}else{$(".alert").addClass("alert-success").removeClass("alert-danger")}$(".alert").css("display","block");$("#alerttext").text(b);setTimeout(function(){$("#alertclose").alert("close")},5000)}google.maps.event.addDomListener(window,"load",initialize);